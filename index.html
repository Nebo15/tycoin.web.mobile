<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>TYCoin</title>

    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1.0, user-scalable=no">

    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- Set a shorter title for iOS6 devices when saved to home screen -->
    <meta name="apple-mobile-web-app-title" content="TYCoin">

    <!-- Set Apple icons for when prototype is saved to home screen -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="views/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="views/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="views/images/icons/apple-touch-icon-57x57.png">

    <!-- Include CSS files -->
    <link rel="stylesheet" href="views/styles/ratchet.css">
    <link rel="stylesheet" href="views/styles/font-awesome.css">
    <link rel="stylesheet" href="views/styles/application.css">

    <!-- Include the compiled verndors JS -->
    <script src="cordova-2.2.0.js"></script>
    <script src="lib/vendor/ratchet.js"></script>
    <script src="lib/vendor/jquery-1.8.2.min.js"></script>
    <script src="lib/vendor/handlebars-1.0.rc.1.js"></script>

    <!-- Include other JS files -->
    <script src="lib/Config.js"></script>
    <script src="lib/Storage.js"></script>
    <script src="lib/Loader.js"></script>
    <script src="lib/Request.js"></script>
    <script src="lib/Response.js"></script>
    <script src="lib/API.js"></script>
    <script src="lib/Template.js"></script>
    <script src="lib/Page.js"></script>
    <script src="lib/Touch.js"></script>
    <script src="lib/Navigation.js"></script>
    <script src="lib/Tools.js"></script>
    <script src="lib/Main.js"></script>

    <!-- Override for developers -->
    <script src="lib/Override.js"></script>

    <!-- Bind navigation -->
    <script type="text/javascript">
      // Init Navigaion
      $(window).load(Navigation.onLoad);

      if(Navigation.getLocation() != 'give')
        getBalance(function() {});

      $(document).bind('pageRender', function() {
        $("#config-button").tap(function() {
          Navigation.redirectToPage('activities');
        });

        $(".button[backpane-id]").tap(function() {
          if($('body').hasClass('openPaneLeft')) {
            $('body').removeClass('openPaneLeft');
            $('#'+$(this).attr('backpane-id')).removeClass('visible');
          } else {
            var $this = $(this);
            var icon = $this.find('.icon-reorder');

            icon.addClass('icon-spin icon-refresh');
            icon.removeClass('icon-reorder');

            updateActivities(function() {
              icon.addClass('icon-reorder');
              icon.removeClass('icon-spin icon-refresh');

              $('#'+$this.attr('backpane-id')).addClass('visible');
              $('body').addClass('openPaneLeft');
            });
          }
        });
      });

      function updateActivities(onSuccess) {
        API.request('GET', '/transaction/history')
          .success(function(response) {
            var current_user = Storage.get('user');
            $.each(response.data.result, function(index, value) {
              if(value.recipient_id == current_user.id) {
                response.data.result[index].subtype = '+';
              } else {
                response.data.result[index].subtype = '-';
              }
            });

            var tpl = Template.loadSubtemplate('activities');
            Template.renderElement(tpl, $('#transaction_history'), {history: response.data.result})

            $(".count").each(function(index) {
              $(this).text(Tools.prettyDate($(this).text() * 1000));
            });

            onSuccess();
          })
          .send();
      }

      $(window).load(function() {
        $("#logout").tap(API.logout);
      });
    </script>
  </head>
  <body>
    <!-- Backpane -->
    <div id="backpane_left" class="backPane">
      <ul class="list">
        <li class="list-divider">Menu</li>
        <li>Intro <span class="chevron"></span></li>
        <li id="logout">Logout <span class="chevron"></span></li>
      </ul>
      <div id="transaction_history">

      </div>
    </div>

    <!-- Header, replaced if neccessary -->
    <header class="bar-title"></header>

    <!-- This is what actually scrolled -->
    <div class="content"></div>

    <!-- Here we will store temporary templates code -->
    <script id="template_holder"></script>

    <!-- Preloader image to dont let users get boored -->
    <div class="preloader">
      <i class="icon-spinner icon-spin icon-2x"></i>
      <p class="text-block">Initializing application...</p>
    </div>

    <!-- Footer, permanent -->
    <nav class="bar-tab">
      <ul class="tab-inner">
        <li class="tab-item" page="give">
          <i class="tab-icon icon-signout icon-large"></i>
          <div class="tab-label">Give <span class="count" id="coins-to-send">0</span></div>
        </li>
        <!--<li class="tab-item" page="take">
          <i class="tab-icon icon-signin icon-large"></i>
          <div class="tab-label">Take</div>
        </li>-->
        <li class="tab-item" page="exchange">
          <i class="tab-icon icon-gift icon-large"></i>
          <div class="tab-label">Exhange <span class="count" id="coins-to-exchange">0</span></div>
        </li>
      </ul>
    </nav>
  </body>
</html>
